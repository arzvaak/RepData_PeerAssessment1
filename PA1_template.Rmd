---
title: "Reproducible Research: Peer Assessment 1"
output: 
  html_document:
    keep_md: true
---

```{r setup, echo=TRUE}
# Show all code in the final report for peer-review transparency
knitr::opts_chunk$set(echo = TRUE)
# Prefer standard decimal formatting instead of scientific notation
options(scipen = 999)
```

## Loading and preprocessing the data

```{r load-data, echo=TRUE}
# Course dataset URL
data_url <- "https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2Factivity.zip"

# Download zip only when it is not already present locally
if (!file.exists("activity.zip")) {
  download.file(data_url, destfile = "activity.zip", mode = "wb")
}

# Extract CSV only when needed
if (!file.exists("activity.csv")) {
  unzip("activity.zip")
}

# Read activity data and parse dates for time-based summaries
activity <- read.csv("activity.csv", stringsAsFactors = FALSE)
activity$date <- as.Date(activity$date)

dim(activity)
head(activity)
summary(activity)
```


## What is mean total number of steps taken per day?

```{r total-steps-per-day, echo=TRUE}
# Ignore missing values for this section
activity_no_na <- activity[!is.na(activity$steps), ]

# Sum steps across intervals to get total steps per day
daily_totals <- aggregate(steps ~ date, data = activity_no_na, sum)

# Distribution of total daily steps
hist(
  daily_totals$steps,
  breaks = 20,
  col = "steelblue",
  border = "white",
  main = "Total Number of Steps Taken Each Day",
  xlab = "Total Steps Per Day"
)

mean_total_steps <- mean(daily_totals$steps)
median_total_steps <- median(daily_totals$steps)

mean_total_steps
median_total_steps
```

The mean total number of steps per day is `r round(mean_total_steps, 2)` and the median is `r round(median_total_steps, 2)`.


## What is the average daily activity pattern?

```{r average-daily-pattern, echo=TRUE}
# Compute mean steps for each 5-minute interval across all days
interval_means <- aggregate(steps ~ interval, data = activity_no_na, mean)

# Time-series style line plot of average interval activity
plot(
  interval_means$interval,
  interval_means$steps,
  type = "l",
  lwd = 2,
  col = "tomato",
  main = "Average Daily Activity Pattern",
  xlab = "5-Minute Interval",
  ylab = "Average Number of Steps"
)

max_interval <- interval_means$interval[which.max(interval_means$steps)]
max_interval_steps <- max(interval_means$steps)

max_interval
max_interval_steps
```

The 5-minute interval with the highest average activity is `r max_interval`, with an average of `r round(max_interval_steps, 2)` steps.


## Imputing missing values

Imputation strategy: replace each missing `steps` value with the mean number of steps for that same 5-minute `interval`, calculated from the non-missing data.

```{r impute-missing, echo=TRUE}
# Count rows where steps is missing
total_missing <- sum(is.na(activity$steps))
total_missing

# Use interval mean to fill missing values
activity_imputed <- activity
missing_idx <- is.na(activity_imputed$steps)

# Replace each missing value using the matching interval mean
activity_imputed$steps[missing_idx] <- interval_means$steps[
  match(activity_imputed$interval[missing_idx], interval_means$interval)
]

sum(is.na(activity_imputed$steps))
```

There are `r total_missing` missing values in the original dataset.

```{r imputed-daily-totals, echo=TRUE}
# Recompute daily totals after imputation
daily_totals_imputed <- aggregate(steps ~ date, data = activity_imputed, sum)

# Distribution of total daily steps after filling missing values
hist(
  daily_totals_imputed$steps,
  breaks = 20,
  col = "darkseagreen3",
  border = "white",
  main = "Total Number of Steps Taken Each Day (Imputed Data)",
  xlab = "Total Steps Per Day"
)

mean_total_steps_imputed <- mean(daily_totals_imputed$steps)
median_total_steps_imputed <- median(daily_totals_imputed$steps)

mean_total_steps_imputed
median_total_steps_imputed

data.frame(
  dataset = c("Original (NA removed)", "Imputed"),
  mean_steps = c(mean_total_steps, mean_total_steps_imputed),
  median_steps = c(median_total_steps, median_total_steps_imputed)
)
```

After imputation, the mean is `r round(mean_total_steps_imputed, 2)` and the median is `r round(median_total_steps_imputed, 2)`. Compared with the original NA-removed dataset, the mean changes by `r round(mean_total_steps_imputed - mean_total_steps, 2)` and the median changes by `r round(median_total_steps_imputed - median_total_steps, 2)`.


## Are there differences in activity patterns between weekdays and weekends?

```{r weekday-weekend-pattern, echo=TRUE}
# Label each date as weekday or weekend
activity_imputed$day_type <- ifelse(
  weekdays(activity_imputed$date) %in% c("Saturday", "Sunday"),
  "weekend",
  "weekday"
)

# Store as ordered factor for consistent panel ordering
activity_imputed$day_type <- factor(
  activity_imputed$day_type,
  levels = c("weekday", "weekend")
)

# Average steps by interval and day type
interval_daytype_means <- aggregate(
  steps ~ interval + day_type,
  data = activity_imputed,
  mean
)

library(lattice)

# Two-panel comparison: weekday vs weekend interval patterns
xyplot(
  steps ~ interval | day_type,
  data = interval_daytype_means,
  type = "l",
  layout = c(1, 2),
  lwd = 2,
  col = "navy",
  xlab = "Interval",
  ylab = "Number of Steps",
  main = "Average Activity Pattern: Weekday vs Weekend"
)
```

```{r weekday-weekend-summary, echo=TRUE}
# Overall average steps per interval by day type
overall_by_daytype <- aggregate(steps ~ day_type, data = activity_imputed, mean)
overall_by_daytype
```

The activity pattern differs between weekdays and weekends, and the average number of steps per interval is `r round(overall_by_daytype$steps[overall_by_daytype$day_type == "weekday"], 2)` on weekdays versus `r round(overall_by_daytype$steps[overall_by_daytype$day_type == "weekend"], 2)` on weekends.
